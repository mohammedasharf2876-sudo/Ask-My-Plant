<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฌุงููุฑู ููุณุฉ - ูุณุงุนุฏู ุงูุฐูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #fdf2f8; } /* ููู ูุฑุฏู ูุงุชุญ */
        .chat-bubble { max-width: 85%; padding: 12px; border-radius: 12px; position: relative; line-height: 1.5; }
        .user-msg { background-color: #db2777; color: white; align-self: flex-end; border-bottom-left-radius: 0; }
        .bot-msg { background-color: white; color: #1f2937; align-self: flex-start; border-bottom-right-radius: 0; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .typing-dot { width: 6px; height: 6px; background: #db2777; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="h-screen flex flex-col max-w-md mx-auto bg-white shadow-2xl overflow-hidden border-x border-pink-100">

    <header class="bg-pink-600 text-white p-4 shadow-md z-10 flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-xl backdrop-blur-sm">๐</div>
        <div>
            <h1 class="font-bold text-lg" id="headerTitle">ุฌุงููุฑู ููุณุฉ</h1>
            <p class="text-xs text-pink-100 flex items-center gap-1">
                <span class="w-2 h-2 bg-pink-300 rounded-full animate-pulse"></span> ูุณุชุดุงุฑ ุงููุฏุงูุง ุงูุฐูู
            </p>
        </div>
    </header>

    <div id="chatBox" class="flex-1 overflow-y-auto p-4 space-y-4 flex flex-col bg-[url('https://www.transparenttextures.com/patterns/diamond-upholstery.png')]">
        </div>

    <div id="loading" class="hidden px-4 py-2">
        <div class="bg-white p-3 rounded-xl inline-block shadow-sm border border-pink-100">
            <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
        </div>
    </div>

    <div class="p-3 bg-white border-t border-pink-100">
        <div class="flex items-center gap-2 bg-pink-50 p-1.5 rounded-full border border-pink-200 focus-within:border-pink-500 focus-within:ring-1 focus-within:ring-pink-500 transition-all">
            <input type="text" id="userInput" 
                class="flex-1 bg-transparent border-none outline-none px-3 text-gray-700 placeholder-pink-300 h-10"
                placeholder="ุงุณุฃูููู ุนู ุงูุฎุงุชูุ ุงูุณูุณูุฉ..." autocomplete="off">
            
            <button onclick="handleSend()" id="sendBtn" 
                class="bg-pink-600 hover:bg-pink-700 text-white w-10 h-10 rounded-full flex items-center justify-center transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 transform -rotate-180">
                    <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                </svg>
            </button>
        </div>
    </div>

<script>
    // 1. ููุชุงุญ ุงูู API (ููุณ ููุชุงุญู ุดุบุงู)
    const API_KEY = "AIzaSyBYuDzE05mcTjRn6y9OC3UQbH6ppD4OXL4"; 
    
    // 2. ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฅูุณุณูุงุฑุงุช (ุงููุตุงุฆุญ ุงูุซุงุจุชุฉ)
    const accessoryDB = {
        "ุฎุงุชู": "๐ **ูุตูุญุฉ ููุฎุงุชู:**<br>1. ุจูุงุด ุชุบุณูู ุฅูุฏู ุจูู ูุชูุฑ ุนุดุงู ุงููุตูุต ุจุชููุน ุฃูู ูุน ุงูุตุงุจูู.<br>2. ูู ุงูุฎุงุชู ุฏูุจ ุตูููุ ุงุจุนุฏูู ุนู ุงูุจุฑูุงู ูุงููุญูู.<br>3. ุฎููู ุจุงูู ูุงูุชู ุจุชูุจุณูู ูู ุงูุดุชุงุก ุนุดุงู ุงูุตูุงุจุน ุจุชูุด ุดููุฉ ููููู ููุน!",
        "ุณูุณูุฉ": "๐ฟ **ูุตูุญุฉ ููุณูุณูุฉ:**<br>1. ุจูุงุด ุชูุงูู ุจููุง ุนุดุงู ูุด ุชุชุนูุฏ ุฃู ุชุชูุทุน.<br>2. ูู ุฑููุนุฉุ ุจูุงุด ุชุนููู ูููุง ุฏูุงูุฉ ุชูููุฉ.<br>3. ุงุญูุธููุง ููุฑูุฏุฉ ูู ุงูุนูุจุฉ ุนุดุงู ูุชุดุจูุด.",
        "ุงูุณูุงู": "โจ **ูุตูุญุฉ ููุฃูุณูุงู:**<br>1. ุฎูู ุจุงูู ูุงูุชู ุจุชูุจุณู ูุฏูู ุตูู ุนุดุงู ูุด ูุดุจู ูููุง.<br>2. ูู ููู ุฏูุงูุงุชุ ุงุชุฃูุฏู ุฅู ุญููุงุชูุง ูููููุฉ ูููุณ.<br>3. ูู ุญุณูุชู ุงูููู ููููุ ูุงุชูู ูุถุจุทู ููุฑุงู.",
        "ุบูุงูุด": "๐ซ **ูุตูุญุฉ ููุบูุงูุด:**<br>1. ุงุจุนุฏููุง ุนู ุงูุฎุจุทุงุช ุงูุฌุงูุฏุฉ ุนุดุงู ูุชุจูุด (ูู ููุฑุบุฉ).<br>2. ูู ุถููุฉุ ุงูุจุณููุง ุจููุณ ุจูุงุณุชูู ุฃู ุดุฑุงุจ ูุงูููู ุนุดุงู ุชุฏุฎู ุจุณูููุฉ.<br>3. ููุนููุง ุจูุทูุฉ ูุงุดูุฉ ูู ูุชุฑุฉ.",
        "ุญูู": "๐ **ูุตูุญุฉ ููุญูู:**<br>1. ุงูุจุฑููุฉ (ุงูููู) ูุงุฒู ุชุชุฃูุฏู ุฅููุง ูุงุณูุฉ ูููุณ ูุจู ูุง ุชุฎุฑุฌู.<br>2. ูู ุงูุญูู ุทูููุ ุจูุงุด ุชูุจุณูู ูุน ููููุฉ ุฃู ุทุฑุญุฉ ุจุชุดุจู ููู.<br>3. ุงูุณุญูู ุจูุญูู ูุจู ุงููุจุณ ูู ูุฏูู ุญุณุงุณุฉ.",
        "ุณุงุนุฉ": "โ **ูุตูุญุฉ ููุณุงุนุฉ:**<br>1. ุญุชู ูู ุถุฏ ุงูููุฉุ ุจูุงุด ุชุถุบุทู ุนูู ุงูุฒุฑุงูุฑ ููู ูุจูููุฉ.<br>2. ุงูุฌูุฏ ุจูุจูุธ ูู ุงูููุฉ ูุงูุจุฑูุงูุ ุงููุนุฏู ุจูุณุชุญูู ุฃูุชุฑ.<br>3. ุบูุฑู ุงูุจุทุงุฑูุฉ ุฃูู ูุง ุชูู ุนุดุงู ูุชููุญุด ุฌูู ุงููููุฉ.",
        "ุฏุจูุฉ": "๐ **ูุตูุญุฉ ููุฏุจูุฉ:**<br>1. ุฏู ุฑูููุฉ ุงูุนูุฑุ ุจุณ ุจูุงุด ุชููุน ุงูุฃูุงูู ุจููุง ุนุดุงู ุงูููุงุฏ ุงููููุงููุฉ ุจุชุทููู ููุนุชูุง.<br>2. ูู ูุณุนุช ุนููููุ ุนูุฏูุง ุญููู ูุชุถููููุง ุจุฏูู ูุต.",
        "ุทูู": "๐ **ูุตูุญุฉ ููุทูู ุงููุงูู:**<br>1. ููุง ุชููุนููุ ุญุทู ูู ูุทุนุฉ ูู ููุงููุง ูู ุงูุนูุจุฉ ุนุดุงู ููุญููุด ูู ุจุนุถ ููุชุฎุฑุจุดูุง.<br>2. ุฏู ููููุงุณุจุงุชุ ุจูุงุด ุชูุจุณูู ูู ุงููุดุงููุฑ ุงูููููุฉ ุนุดุงู ูุนูุด.",
        "ุนุงูุฉ": "ุฃูุง ุฎุจูุฑุฉ ุงูุฅูุณุณูุงุฑุงุช ูู 'ููุณุฉ'.<br>ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ: **ุงูุฅูุณุณูุงุฑ ุขุฎุฑ ุญุงุฌุฉ ุชุชูุจุณ (ุจุนุฏ ุงูุจุฑูุงู ูุงููููุจ) ูุฃูู ุญุงุฌุฉ ุชุชููุน.**"
    };

    // 3. ุชุญุฏูุฏ ููุน ุงููุทุนุฉ ูู ุงูุฑุงุจุท
    const params = new URLSearchParams(window.location.search);
    let pType = params.get('type') || "ุนุงูุฉ";
    pType = pType.replace(/_/g, ' '); 

    // ุชุญุฏูุซ ุงูุนููุงู
    if(pType !== "ุนุงูุฉ") {
        document.getElementById('headerTitle').innerHTML = `ูุทุนุฉ: <span class="text-yellow-200">${pType}</span>`;
    }

    const chatBox = document.getElementById('chatBox');
    const input = document.getElementById('userInput');
    const loading = document.getElementById('loading');
    
    // ุชุนูููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุงูุดุฎุตูุฉ ุงูุฌุฏูุฏุฉ)
    let conversationHistory = [
        {
            role: "user",
            parts: [{ text: `ุฃูุช ูุณุงุนุฏุฉ ุฐููุฉ ูุฐูู ุฌุฏุงู ูู ุฌุงููุฑู ุฅูุณุณูุงุฑุงุช ููุฏุงูุง ุงุณูู "ููุณุฉ".
            ุฏูุฑู: ูุณุงุนุฏุฉ ุงูุนููุงุก (ูุบุงูุจุงู ุจูุงุช ูุณูุฏุงุช) ูู ุงูุนูุงูุฉ ุจูุทุนุฉ: "${pType}".
            
            **ุชุนูููุงุช ูููุฉ:**
            1. ุชุญุฏุซู ุจููุฌุฉ ูุตุฑูุฉ ุฑุงููุฉ ูุจูุงุชู (ูุง ููุฑุ ูุง ุฌูููุฉุ ูุง ููุฏู).
            2. ุฃูู ุชุญุฐูุฑ ูุฃู ูุทุนุฉ: "ุงุจุนุฏู ุนููุง ุงูุจุฑูุงู ูุงููุญูู ูุงูุตุงุจูู ุงููุจุงุดุฑ ุนุดุงู ููุนุชูุง ุชุฏูู".
            3. ูู ุณุฃูุช ุนู ุงูุณุนุฑ: "ุงูุฃุณุนุงุฑ ุญุณุจ ุงููุทุนุฉ ูุงููุฒูุ ููุฑููุง ูู ุงูุฌุงููุฑู ูููุนูู ูุนุงูู ุฃุญูู ูุงุฌุจ".
            4. ูููู ูุฏูุฏุฉ ุฌุฏุงู ููุฎุชุตุฑุฉ.` }]
        },
        {
            role: "model",
            parts: [{ text: "ุฃููุงู ูุง ุฌูููุฉ! ๐ ูุจุฑูู ุนูููู ุงููุทุนุฉ ุฏูุ ุฐููู ูุฌูู! ุฃุณุนุฏู ุฅุฒุงู ุชุญุงูุธู ุนูููุงุ" }]
        }
    ];

    // ุฑุณุงูุฉ ุงูุชุฑุญูุจ ุงูุชููุงุฆูุฉ (ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ ูุณุฑุนุฉ ุงูุฑุฏ)
    let welcomeMsg = `ุฃููุงู ุจููู ูู **ููุณุฉ**! ๐<br>ูุจุฑูู ุนูููู ุงูู <b>${pType}</b>ุ ุฐููู ุชุญูุฉ!`;
    if(accessoryDB[pType]) {
        welcomeMsg += `<br><br>${accessoryDB[pType]}`;
    }
    addMessage(welcomeMsg, false);

    function addMessage(text, isUser) {
        const div = document.createElement('div');
        div.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
        div.innerHTML = `
            <div class="chat-bubble ${isUser ? 'user-msg' : 'bot-msg'}">
                ${text.replace(/\n/g, '<br>')}
            </div>
        `;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function handleSend() {
        const text = input.value.trim();
        if (!text) return;

        addMessage(text, true);
        input.value = '';
        loading.classList.remove('hidden');
        
        conversationHistory.push({ role: "user", parts: [{ text: text }] });

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: conversationHistory })
            });

            const data = await response.json();
            loading.classList.add('hidden');

            if (data.candidates && data.candidates[0].content) {
                const reply = data.candidates[0].content.parts[0].text;
                addMessage(reply, false);
                conversationHistory.push({ role: "model", parts: [{ text: reply }] });
            } else {
                // ุงูุฑุฏ ุงูุงุญุชูุงุทู
                let fallback = "ูุง ุฎุจุฑ! ุงููุช ุนูู ุดููุฉ ๐. ";
                if(text.includes("ุณุนุฑ") || text.includes("ุจูุงู")) fallback += "ุงูุฃุณุนุงุฑ ุนูุฏูุง ูููุฒุฉ ุฌุฏุงูุ ููุฑููุง ุชุดููู ุจููุณู.";
                else if(text.includes("ุตุฏุช") || text.includes("ููู")) fallback += "ูุชููููุดุ ุนูุฏูุง ุชูููุน ูุตูุงูุฉ ุชุฑุฌุนูุง ุฌุฏูุฏุฉ.";
                else fallback += "ูููู ุชูููู ุชุงูู ูุง ููุฑุ";
                addMessage(fallback, false);
            }

        } catch (error) {
            console.error(error);
            loading.classList.add('hidden');
            addMessage("ููู ูุดููุฉ ูู ุงูุดุจูุฉุ ุฌุฑุจู ุชุงูู ูุง ุฌูููุฉ.", false);
        }
    }

    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSend();
    });
</script>
</body>
</html>
