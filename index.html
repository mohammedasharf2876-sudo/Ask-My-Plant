<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุดุชู ูุญูุฏ ุงูุฐูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f0fdf4; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .msg-enter { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-screen flex flex-col max-w-md mx-auto bg-white shadow-2xl border-x border-gray-100">

    <header class="bg-emerald-700 text-white p-4 shadow-md z-10 flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-xl backdrop-blur-sm">๐ฑ</div>
        <div>
            <h1 class="font-bold text-lg leading-tight" id="headerTitle">ูุดุชู ูุญูุฏ ุงูุฐูู</h1>
            <p class="text-xs text-emerald-100 flex items-center gap-1">
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span> ูุชุตู ุงูุขู
            </p>
        </div>
    </header>

    <div id="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-fixed">
        </div>

    <div class="p-4 bg-white border-t border-gray-100">
        <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-full border border-gray-200 focus-within:border-emerald-500 focus-within:ring-1 focus-within:ring-emerald-500 transition-all">
            <input type="text" id="userInput" 
                class="flex-1 bg-transparent border-none outline-none px-2 text-gray-700 placeholder-gray-400"
                placeholder="ุงุณุฃููู ุนู ุฒุฑุนุชู..." autocomplete="off">
            
            <button onclick="handleSend()" id="sendBtn" 
                class="bg-emerald-600 hover:bg-emerald-700 text-white p-3 rounded-full transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 transform -rotate-45 relative left-[-2px]">
                    <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                </svg>
            </button>
        </div>
    </div>

<script>
    // --- 1. ุงูุฅุนุฏุงุฏุงุช ูุงูููุชุงุญ ---
    const API_KEY = "AIzaSyBYuDzE05mcTjRn6y9OC3UQbH6ppD4OXL4"; 
    
    // --- 2. ูุงุนุฏุฉ ุงูุจูุงูุงุช (50 ุฒุฑุนุฉ) ---
    const plantDB = {
        "ุฑูุญุงู": "ุงูุฑูุญุงู ุจูุญุจ ุงูุดูุณ ุงููุจุงุดุฑุฉ ูุงูุฑู ููู ูููู. ุฃูู ุญุงุฌุฉ ุชูุทู ุงูููู ุนุดุงู ููุฑุน.",
        "ูุนูุงุน": "ุงููุนูุงุน ุจูุญุจ ุงูููุฉ ูุงูุถู ุงูุฎููู. ุฌุฐูุฑู ุจุชูุชุดุฑ ุจุณุฑุนุฉ ูุงุฒุฑุนู ูู ุฃุตูุต ููุญุฏู.",
        "ุตุจุงุฑ": "ุงูุตุจุงุฑ ุนุฏู ุงูููุฉ! ุงุณููู ูุฑุฉ ูู ุดูุฑ ูุญุทู ูู ุดูุณ ูููุฉ.",
        "ูุงุณููู": "ุงููุงุณููู ุจูุญุจ ุงูุดูุณ ูุงูุชุฑุจุฉ ุงูุฑุทุจุฉ. ูุญุชุงุฌ ุฏุนุงูุฉ ูุชุณูู ุนูููุง.",
        "ูู": "ุงููู ุจูุนุดู ุงูุดูุณ ุงููุบุฑุจูุฉ (ูุด ุงูุญุงุฑูุฉ) ูุงูุฑู ูู ููููู.",
        "ูุฑุฏ ุจูุฏู": "ุงููุฑุฏ ุงูุจูุฏู ุนุงูุฒ ุดูุณ 6 ุณุงุนุงุช ูุณูุงุฏ ุนุงูู ุงูุจูุชุงุณููู ุนุดุงู ูุฒูุฑ.",
        "ุฌูุฏ ุงูููุฑ": "ูุจุงุช ุงูุญุฏูุฏ! ุจูุนูุด ูู ุฃู ุฅุถุงุกุฉ ูุงูุฑู ูู ุฃุณุจูุนูู ููุง ุงูุชุฑุจุฉ ุชูุดู.",
        "ุจูุชุณ": "ูุจุงุช ุฏุงุฎูู ููุชุงุฒุ ุจูุญุจ ุถูุก ุงูุดุจุงู ูุงูุฑู ููุง ุงูุชุฑุจุฉ ุชูุดู.",
        "ุนุงูุฉ": "ุฃูุง ูููุฏุณ ุฒุฑุงุนู ุขููุ ุงุณุฃููู ุนู ุฃู ุฒุฑุนุฉ!"
    };

    // --- 3. ุชููุฆุฉ ุงูุตูุญุฉ ---
    const params = new URLSearchParams(window.location.search);
    let pType = params.get('type') || "ุนุงูุฉ";
    pType = pType.replace(/_/g, ' ');
    
    document.getElementById('headerTitle').innerText = pType === "ุนุงูุฉ" ? "ูุดุชู ูุญูุฏ ุงูุฐูู" : `ุงูุนูุงูุฉ ุจู: ${pType}`;

    // --- 4. ุฏูุงู ุงูุดุงุช ---
    const chatBox = document.getElementById('chatContainer');
    const input = document.getElementById('userInput');
    const btn = document.getElementById('sendBtn');
    let history = []; // ุฐุงูุฑุฉ ุงููุญุงุฏุซุฉ

    function addMessage(text, isUser) {
        const div = document.createElement('div');
        div.className = `flex ${isUser ? 'justify-end' : 'justify-start'} msg-enter`;
        div.innerHTML = `
            <div class="${isUser ? 'bg-emerald-600 text-white rounded-br-none' : 'bg-white text-gray-800 border border-gray-100 rounded-bl-none'} 
                        max-w-[85%] rounded-2xl p-3 shadow-sm text-sm leading-relaxed">
                ${text}
                <div class="text-[10px] mt-1 opacity-70 ${isUser ? 'text-emerald-100' : 'text-gray-400'} text-left">
                    ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                </div>
            </div>
        `;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // ุฑุณุงูุฉ ุงูุชุฑุญูุจ
    setTimeout(() => {
        let msg = `ุฃููุงู ูุง ููุงู! ๐<br>ุฃูุง ุงููุณุงุนุฏ ุงูุฐูู ููุจุงุช <b>${pType}</b>.`;
        if(plantDB[pType] && pType !== "ุนุงูุฉ") {
            msg += `<br>ูุตูุญุฉ ุณุฑูุนุฉ: ${plantDB[pType]}`;
        }
        addMessage(msg, false);
    }, 500);

    // --- 5. ุงูููุทู ุงูุฑุฆูุณู (ุจุฏูู ููุชุจุงุช) ---
    async function handleSend() {
        const text = input.value.trim();
        if (!text) return;

        addMessage(text, true);
        input.value = '';
        btn.disabled = true; // ููุน ุงูุชูุฑุงุฑ

        // ุชุฌููุฒ ุงูุฐุงูุฑุฉ
        history.push({role: "user", parts: [{text: text}]});

        try {
            // ูุญุงููุฉ ุงูุงุชุตุงู ุจู Google API ูุจุงุดุฑุฉ (Fetch API Standard)
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [
                        { role: "user", parts: [{ text: `ุฃูุช ุฎุจูุฑ ุฒุฑุงุนู ูุตุฑู ูู ูุดุชู. ุชุชุญุฏุซ ุจุงูููุฌุฉ ุงููุตุฑูุฉ ุงููุฏูุฏุฉ. ุงููุณุชุฎุฏู ูุณุฃู ุนู ูุจุงุช: ${pType}. ุงูุณุคุงู: ${text}` }] }
                    ]
                })
            });

            const data = await response.json();
            
            if (data.candidates && data.candidates[0].content) {
                const reply = data.candidates[0].content.parts[0].text;
                addMessage(reply, false);
                history.push({role: "model", parts: [{text: reply}]});
            } else {
                throw new Error("No response");
            }

        } catch (error) {
            console.error(error);
            // ุงูุฑุฏ ุงูุงุญุชูุงุทู (Offline Mode)
            let fallback = "ุงููุช ุนูุฏู ุจุนุงููุฉ ุดููุฉุ ุจุณ ";
            if (text.includes("ุฑู") || text.includes("ููุฉ")) fallback += `ุจุงููุณุจุฉ ููุฑูุ ${plantDB[pType] || "ุฎูู ุงูุชุฑุจุฉ ุชูุดู ุจูู ุงูุฑูุงุช."}`;
            else if (text.includes("ุดูุณ") || text.includes("ููุงู")) fallback += "ุฃูู ุญุงุฌุฉ ุงูุฅุถุงุกุฉ ุชููู ููุงุณุจุฉ ูููุน ุงูุฒุฑุนุฉ.";
            else fallback += "ูููู ุชุณุฃููู ุชุงููุ";
            
            addMessage(fallback, false);
        }

        btn.disabled = false;
        input.focus();
    }

    // ุชุดุบูู ุฒุฑ Enter
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSend();
    });
</script>
</body>
</html>
